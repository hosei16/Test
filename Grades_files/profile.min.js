"use strict";define(["jquery","lodash","phpjs","bootstrap","main"],function(o,a,e){return function(t){function i(a){var e=0===a?Camera.PictureSourceType.CAMERA:Camera.PictureSourceType.PHOTOLIBRARY;navigator.camera.getPicture(function(a){o("#upload-photo-uri").val(a).change()},function(o){console.error(o)},{quality:70,targetWidth:500,targetHeight:500,destinationType:Camera.DestinationType.DATA_URL,sourceType:e,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,saveToPhotoAlbum:!1})}t=o.extend({},{pageURL:"",editPhotoURL:""},t);var l=o("#user-profile-dialog"),d=o("#edit-photo-dialog");l.one("show.bs.modal",function(){l.addClass("modal-scrollfix").find(".modal-body").load(t.pageURL,function(a,e,t){200!==t.status&&o(this).html(t.statusText),l.removeClass("modal-scrollfix").modal("handleUpdate")})}).on("hide.bs.modal",function(){window.history.go(-1)}),window.location.hash.length>0&&"#profile"===window.location.hash&&l.modal("show"),o(window).on("hashchange",function(){"#profile"===window.location.hash?l.modal("show"):l.is(":visible")&&l.modal("hide")}),d.on("show.bs.modal",function(){d.addClass("modal-scrollfix").find(".modal-body").load(t.editPhotoURL,function(a,e,t){200!==t.status&&o(this).html(t.statusText),d.removeClass("modal-scrollfix").modal("handleUpdate"),o(document).trigger("style-forms")})}).on("hidden.bs.modal",function(){d.find(".modal-body").html("loading...")}),o(document).on("keyup","#gravatar-email",a.debounce(function(){var a=o(this).val(),t="https://secure.gravatar.com/avatar/<hash>?d=mm&s=200",i=e.md5(a.trim().toLowerCase());t=t.replace("<hash>",i),d.addClass("modal-scrollfix"),o("<img/>").attr("src",t).load(function(){o(this).remove(),o("#gravatar-img").css("background-image","url("+t+")").removeClass("hidden"),d.removeClass("modal-scrollfix").modal("handleUpdate")})},1500)),o(document).one("show.bs.modal","#confirmUploadFile",function(){var a=o("#template-upload-photo-terms").html();o("#upload-photo-terms").html(a),o("#agree-terms").prop("checked",!1).trigger("change")}).on("submit","#edit-photo-form",function(a){var e=window.location.href.replace(window.location.hash,""),t=o("#upload-photo-file"),i=t.length>0&&(""!==t.val()||""!==o("#upload-photo-uri").val()),l=o('[name="agree_terms"]').length>0;i&&!l&&(a.preventDefault(),o("#confirmUploadFile").modal("show")),o("<input>").attr({type:"hidden",name:"redirect_url"}).val(e).appendTo("#edit-photo-form")}).on("click vclick","#confirmUploadFile .confirm-upload-file",function(){o("<input>").attr({type:"hidden",name:"agree_terms"}).val("Y").appendTo("#edit-photo-form"),o("#edit-photo-form").submit()}).on("change","#agree-terms",function(){var a=o(this).is(":checked");o("#confirmUploadFile").find(".confirm-upload-file").prop("disabled",!a)}),o(document).on("change","#upload-photo-file",function(){var e=o(this),t=e.data("target"),i=this.files[0];if(!i)return o("#upload-img").addClass("hidden"),o("#photo-max-size-error").addClass("hidden"),void o(t).html("");var l=i.name,n=e.data("template"),r=a.template(o("#"+n).html())({fileName:l}),s=window.maxUploadSize||2097152;if(Modernizr.filereader){var m=new FileReader;m.onload=function(a){var e=a.target.result;d.addClass("modal-scrollfix"),o("<img/>").attr("src",e).load(function(){o(this).remove(),o("#upload-img").css("background-image","url("+e+")").removeClass("hidden"),d.removeClass("modal-scrollfix").modal("handleUpdate")})},m.readAsDataURL(i),o("#photo-max-size-error").toggleClass("hidden",i.size<=s)}o(t).html(r)}).on("change","#upload-photo-uri",function(){var a=o(this).val();d.addClass("modal-scrollfix"),o("<img/>").attr("src","data:image/jpeg;base64,"+a).load(function(){o(this).remove(),o("#upload-img").css("background-image","url(data:image/jpeg;base64,"+a+")").removeClass("hidden"),d.removeClass("modal-scrollfix").modal("handleUpdate")})}),o.browser.isHybrid&&o(document).on("click","#upload-photo-file",function(){window.chooser.init().add_action("Take Photo",function(){setTimeout(i(0),0)},null).add_action("Choose Photo",function(){setTimeout(i(1),0)},null),window.chooser.show()})}});
//# sourceMappingURL=profile.min.js.map