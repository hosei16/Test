define(["jquery","lodash","phpjs","bootstrap","main"],function(a,b,c){return function(d){function e(b){var c=0===b?Camera.PictureSourceType.CAMERA:Camera.PictureSourceType.PHOTOLIBRARY;navigator.camera.getPicture(function(b){a("#upload-photo-uri").val(b).change()},function(a){console.error(a)},{quality:70,targetWidth:500,targetHeight:500,destinationType:Camera.DestinationType.DATA_URL,sourceType:c,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,saveToPhotoAlbum:!1})}d=a.extend({},{pageURL:"",editPhotoURL:""},d);var f=a("#user-profile-dialog"),g=a("#edit-photo-dialog");f.one("show.bs.modal",function(){f.addClass("modal-scrollfix").find(".modal-body").load(d.pageURL,function(b,c,d){200!==d.status&&a(this).html(d.statusText),f.removeClass("modal-scrollfix").modal("handleUpdate")})}).on("hide.bs.modal",function(){window.history.go(-1)}),window.location.hash.length>0&&"#profile"===window.location.hash&&f.modal("show"),a(window).on("hashchange",function(){"#profile"===window.location.hash?f.modal("show"):f.is(":visible")&&f.modal("hide")}),g.on("show.bs.modal",function(){g.addClass("modal-scrollfix").find(".modal-body").load(d.editPhotoURL,function(b,c,d){200!==d.status&&a(this).html(d.statusText),g.removeClass("modal-scrollfix").modal("handleUpdate"),a(document).trigger("style-forms")})}).on("hidden.bs.modal",function(){g.find(".modal-body").html("loading...")}),a(document).on("keyup","#gravatar-email",b.debounce(function(){var b=a(this).val(),d="https://secure.gravatar.com/avatar/<hash>?d=mm&s=200",e=c.md5(b.trim().toLowerCase());d=d.replace("<hash>",e),g.addClass("modal-scrollfix"),a("<img/>").attr("src",d).load(function(){a(this).remove(),a("#gravatar-img").css("background-image","url("+d+")").removeClass("hidden"),g.removeClass("modal-scrollfix").modal("handleUpdate")})},1500)),a(document).one("show.bs.modal","#confirmUploadFile",function(){var b=a("#template-upload-photo-terms").html();a("#upload-photo-terms").html(b),a("#agree-terms").prop("checked",!1).trigger("change")}).on("submit","#edit-photo-form",function(b){var c=window.location.href.replace(window.location.hash,""),d=a("#upload-photo-file").length>0&&(""!==a("#upload-photo-file").val()||""!==a("#upload-photo-uri").val()),e=a('[name="agree_terms"]').length>0;d&&!e&&(b.preventDefault(),a("#confirmUploadFile").modal("show")),a("<input>").attr({type:"hidden",name:"redirect_url"}).val(c).appendTo("#edit-photo-form")}).on("click vclick","#confirmUploadFile .confirm-upload-file",function(){a("<input>").attr({type:"hidden",name:"agree_terms"}).val("Y").appendTo("#edit-photo-form"),a("#edit-photo-form").submit()}).on("change","#agree-terms",function(){var b=a(this).is(":checked");a("#confirmUploadFile .confirm-upload-file").prop("disabled",!b)}),a(document).on("change","#upload-photo-file",function(){var c=a(this),d=c.data("target"),e=this.files[0];if(!e)return a("#upload-img").addClass("hidden"),a("#photo-max-size-error").addClass("hidden"),void a(d).html("");var f=e.name,h=c.data("template"),i=b.template(a("#"+h).html()),j=i({fileName:f}),k=window.maxUploadSize||2097152;if(Modernizr.filereader){var l=new FileReader;l.onload=function(b){var c=b.target.result;g.addClass("modal-scrollfix"),a("<img/>").attr("src",c).load(function(){a(this).remove(),a("#upload-img").css("background-image","url("+c+")").removeClass("hidden"),g.removeClass("modal-scrollfix").modal("handleUpdate")})},l.readAsDataURL(e),a("#photo-max-size-error").toggleClass("hidden",e.size<=k)}a(d).html(j)}).on("change","#upload-photo-uri",function(){var b=a(this).val();g.addClass("modal-scrollfix"),a("<img/>").attr("src","data:image/jpeg;base64,"+b).load(function(){a(this).remove(),a("#upload-img").css("background-image","url(data:image/jpeg;base64,"+b+")").removeClass("hidden"),g.removeClass("modal-scrollfix").modal("handleUpdate")})}),a.browser.isHybrid&&a(document).on("click","#upload-photo-file",function(){window.chooser.init().add_action("Take Photo",function(){setTimeout(e(0),0)},null).add_action("Choose Photo",function(){setTimeout(e(1),0)},null),window.chooser.show()})}});
//# sourceMappingURL=profile.min.js.map